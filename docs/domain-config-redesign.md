# åŸŸåé…ç½®åŠŸèƒ½ - é‡æ–°è®¾è®¡

**Document ID**: domain-config-redesign-v2.0
**Created**: 2026-01-18
**Status**: Implemented

---

## 1. é—®é¢˜æè¿°

åŸæœ‰åŸŸåé…ç½®åŠŸèƒ½å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
1. ç»‘å®šæ¨¡å¼é€‰æ‹©æŒ‰é’®æ— æ³•ç‚¹å‡»ï¼ˆåŠŸèƒ½ç¼ºå¤±ï¼‰
2. åªæœ‰ä¸»åŸŸåé…ç½®ï¼Œæ²¡æœ‰ç‚®ç°åŸŸåé…ç½®
3. åŸŸåé€‰æ‹©ç­–ç•¥é€‰æ‹©åŠŸèƒ½ä¸æ¸…æ™°

---

## 2. é‡æ–°è®¾è®¡æ–¹æ¡ˆ

### 2.1 ç®€åŒ–è®¾è®¡åŸåˆ™

æ ¹æ®å®é™…éœ€æ±‚ï¼ŒåŸŸåé…ç½®åŠŸèƒ½ç®€åŒ–ä¸ºï¼š

| é…ç½®é¡¹ | è¯´æ˜ | æ“ä½œ |
|-------|------|------|
| **ä¸»åŸŸå** | ç”Ÿäº§ç¯å¢ƒçš„"æ°¸ä¹…å…¥å£" | ç»‘å®šåæ°¸ä¹…é”å®šï¼Œæ— æ³•ä¿®æ”¹ |
| **ç‚®ç°åŸŸå** | å¼¹æ€§å®¹é”™èµ„æº | å¯éšæ—¶æ·»åŠ ã€åˆ é™¤ã€è°ƒæ•´ä¼˜å…ˆçº§ |
| **æ•…éšœè½¬ç§»** | ä¸»åŸŸåå¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢ | å¼€å…³æ§åˆ¶ |

### 2.2 ç§»é™¤çš„åŠŸèƒ½

- ~~ç»‘å®šæ¨¡å¼é€‰æ‹©~~ï¼ˆGLOBAL_POOL/CUSTOM_DOMAINS/HYBRIDï¼‰- ä¸éœ€è¦
- ~~åŸŸåé€‰æ‹©ç­–ç•¥~~ï¼ˆround-robin/random/weighted/priorityï¼‰- ä¸éœ€è¦

### 2.3 UI è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ åŸŸåé…ç½®                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ ä¸»åŸŸåé…ç½® [ğŸ”’ å·²é”å®š]                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ https://primary.example.com              â”‚   â”‚
â”‚ â”‚ ç»‘å®šæ—¶é—´: 2026-01-18 12:00:00           â”‚   â”‚
â”‚ â”‚                                         â”‚   â”‚
â”‚ â”‚ âš ï¸ ä¸»åŸŸåå·²é”å®šï¼Œæ— æ³•ä¿®æ”¹                â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚ ç‚®ç°åŸŸåé…ç½® (3 ä¸ª)         [âœ“ å¯ç”¨æ•…éšœè½¬ç§»]   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ 1. backup1.com    [â†‘] [â†“] [ğŸ—‘ï¸]         â”‚   â”‚
â”‚ â”‚ 2. backup2.com    [â†‘] [â†“] [ğŸ—‘ï¸]         â”‚   â”‚
â”‚ â”‚ 3. backup3.com    [â†‘] [â†“] [ğŸ—‘ï¸]         â”‚   â”‚
â”‚ â”‚                                         â”‚   â”‚
â”‚ â”‚ [é€‰æ‹©ç‚®ç°åŸŸå â–¼] [æ·»åŠ ]                 â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ•°æ®æ¨¡å‹

### 3.1 DomainConfig æ¥å£

```typescript
interface DomainConfig {
  // ä¸»åŸŸåé…ç½®ï¼ˆé”å®šåä¸å¯ä¿®æ”¹ï¼‰
  primaryDomain?: {
    domainId: string;
    domain: string;
    protocol: 'http' | 'https';
    lockedAt: string;
    locked: boolean;
  };

  // ç‚®ç°åŸŸåé…ç½®ï¼ˆå®Œå…¨çµæ´»ï¼‰
  fallbackDomains: {
    domainIds: string[];     // ç‚®ç°åŸŸåIDåˆ—è¡¨ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
    priority: number[];      // ä¼˜å…ˆçº§é¡ºåºï¼ˆ1, 2, 3...ï¼‰
    updatedAt: string;
    failoverEnabled: boolean; // æ˜¯å¦å¯ç”¨æ•…éšœè½¬ç§»
  };

  // åŸŸåé€‰æ‹©ç­–ç•¥ï¼ˆä¿ç•™ä½†UIä¸æ˜¾ç¤ºï¼‰
  strategy: 'round-robin' | 'random' | 'weighted';
}
```

---

## 4. åŠŸèƒ½å®ç°

### 4.1 ä¸»åŸŸåé…ç½®

- **ç»‘å®š**ï¼šä»åŸŸåæ± é€‰æ‹©æ´»è·ƒåŸŸå
- **ç¡®è®¤**ï¼šå¼¹çª—ç¡®è®¤ï¼ˆå‘ŠçŸ¥é”å®šåä¸å¯ä¿®æ”¹ï¼‰
- **é”å®š**ï¼šç»‘å®šåè®¾ç½® `locked: true`
- **æ˜¾ç¤º**ï¼šç¥ç€è‰²è¾¹æ¡†ï¼Œé”å®šå›¾æ ‡

### 4.2 ç‚®ç°åŸŸåé…ç½®

- **æ·»åŠ **ï¼šä»åŸŸåæ± é€‰æ‹©åŸŸåï¼ˆæ’é™¤ä¸»åŸŸåå’Œå·²æ·»åŠ çš„ï¼‰
- **åˆ é™¤**ï¼šç‚¹å‡»åˆ é™¤æŒ‰é’®
- **ä¸Šç§»/ä¸‹ç§»**ï¼šè°ƒæ•´ä¼˜å…ˆçº§é¡ºåº
- **æ˜¾ç¤º**ï¼šç´«è‰²ä¸»é¢˜ï¼Œå¸¦åºå·æ ‡è¯†

### 4.3 æ•…éšœè½¬ç§»

- **å¼€å…³**ï¼šcheckbox æ§åˆ¶
- **é€»è¾‘**ï¼šä¸»åŸŸåå¤±è´¥æ—¶æŒ‰ä¼˜å…ˆçº§ä½¿ç”¨ç‚®ç°åŸŸå

---

## 5. API æ¥å£

```typescript
// GET /api/admin/live-codes/:id/domain-config
// è·å–åŸŸåé…ç½®

// PUT /api/admin/live-codes/:id/domain-config
// æ›´æ–°åŸŸåé…ç½®ï¼ˆç‚®ç°åŸŸåã€æ•…éšœè½¬ç§»ï¼‰
interface UpdateDomainConfigRequest {
  fallbackDomains?: {
    domainIds: string[];
    priority: number[];
    failoverEnabled: boolean;
  };
  strategy?: string;
}

// POST /api/admin/live-codes/:id/domain-config/primary
// ç»‘å®šä¸»åŸŸå
interface BindPrimaryDomainRequest {
  domainId: string;
  confirmed: boolean;
}

// DELETE /api/admin/live-codes/:id/domain-config/primary
// è§£ç»‘ä¸»åŸŸåï¼ˆç®¡ç†å‘˜ï¼‰
interface UnbindPrimaryDomainRequest {
  forceUnbind: boolean;
  confirmationCode: string;
}
```

---

## 6. é¢œè‰²ä¸»é¢˜

| å…ƒç´  | é¢œè‰² | Tailwind ç±» |
|-----|------|------------|
| ä¸»åŸŸå | è“è‰² | `text-blue-600`, `bg-blue-600` |
| ä¸»åŸŸåé”å®š | ç¥ç€è‰² | `text-amber-600`, `bg-amber-100` |
| ç‚®ç°åŸŸå | ç´«è‰² | `text-purple-600`, `bg-purple-600` |
| æˆåŠŸæç¤º | ç»¿è‰² | `text-green-700`, `bg-green-50` |
| é”™è¯¯æç¤º | çº¢è‰² | `text-red-700`, `bg-red-50` |

---

## 7. æ–‡ä»¶å˜æ›´

- `client/src/components/DomainConfigPanel.tsx` - å®Œå…¨é‡å†™

---

## 8. æµ‹è¯•è¦ç‚¹

1. ä¸»åŸŸåç»‘å®šç¡®è®¤å¼¹çª—
2. ä¸»åŸŸåé”å®šåæ— æ³•ä¿®æ”¹
3. ç‚®ç°åŸŸåæ·»åŠ ï¼ˆæ’é™¤ä¸»åŸŸåï¼‰
4. ç‚®ç°åŸŸååˆ é™¤
5. ç‚®ç°åŸŸåä¼˜å…ˆçº§è°ƒæ•´
6. æ•…éšœè½¬ç§»å¼€å…³
