# 管理后台开发计划（Admin Development Plan）

## 概览
本文档基于`admin-design.md`设计文档，规划管理后台的开发任务、优先级和实施路径。

---

## 开发阶段划分

### 阶段 1: 基础设施搭建（Phase 1 - Foundation）
**目标**: 建立前后端基础架构，确保开发环境可用

#### 前端基础设施
- [ ] 任务1: 创建前端项目基础结构
  - 初始化Vue 3 + Vite项目
  - 安装Element Plus
  - 配置TypeScript
  - 配置ESLint + Prettier
  - 设置开发服务器

- [ ] 任务2: 配置项目基础设施
  - 设置Vue Router（路由配置）
  - 集成Pinia（状态管理）
  - 封装Axios（HTTP客户端）
  - 配置环境变量（.env文件）
  - 设置全局样式和主题

#### 后端基础设施
- [ ] 任务3: 创建后端API基础结构
  - 初始化Fastify服务器
  - 配置CORS
  - 设置静态文件服务（服务前端dist）
  - 配置请求日志
  - 错误处理中间件

- [ ] 任务4: 实现认证系统
  - 登录API接口
  - JWT token生成和验证
  - 认证中间件（保护/admin路由）
  - Token刷新机制
  - 登出接口

#### 数据层
- [ ] 任务5: 创建活码数据模型
  - 设计JSON结构（config.json, stats.json）
  - 定义TypeScript类型
  - 实现数据访问层（DAL）
  - 配置文件读写工具（fs-extra）
  - 实现JSON文件锁定（proper-lockfile）

**验证标准**:
- [ ] 前端开发服务器可正常启动（端口3000）
- [ ] 后端服务器可正常启动（端口8080）
- [ ] 登录功能可用，token正确生成和验证
- [ ] JSON文件可正常读写，锁定机制有效

---

### 阶段 2: 核心功能实现（Phase 2 - Core Features）
**目标**: 实现活码管理的核心功能

#### 前端 - 登录模块
- [ ] 任务6: 设计并实现登录页面
  - 居中卡片布局
  - 表单验证（非空）
  - 登录逻辑（调用API）
  - 错误提示（密码错误、网络错误）
  - Loading状态
  - 登录成功后跳转到主页

- [ ] 任务7: 实现路由守卫
  - 未登录自动跳转到登录页
  - Token过期自动登出
  - 权限验证

#### 前端 - 主框架
- [ ] 任务8: 创建后台主框架
  - 顶部导航栏（系统名称、状态指示、用户菜单）
  - 侧边栏（菜单项、选中高亮）
  - 主内容区（页面容器）
  - 响应式布局

#### 前端 - 活码列表
- [ ] 任务9: 设计并实现活码卡片组件
  - 二维码展示（80×80px）
  - 活码名称和状态标签
  - 数据字段（总PV、当前子码、剩余阈值）
  - 操作按钮（编辑、数据、推广码）

- [ ] 任务10: 实现活码列表页面
  - 卡片网格布局（2×2）
  - 数据加载（调用API）
  - 状态管理（Pinia store）
  - 空状态处理
  - Loading状态

#### 后端 - 活码API
- [ ] 任务11: 实现活码CRUD API
  - GET /api/admin/live-codes（列表）
  - POST /api/admin/live-codes（创建）
  - PUT /api/admin/live-codes/:id（更新）
  - DELETE /api/admin/live-codes/:id（删除）
  - GET /api/admin/live-codes/:id（详情）
  - 数据验证（使用zod）

#### 前端 - 创建/编辑活码
- [ ] 任务12: 设计并实现新建活码抽屉
  - 基本信息表单（活码名称、分流模式）
  - 子码管理表格
  - 文件上传区域（点击或拖拽）
  - 表单验证
  - 保存/取消按钮

- [ ] 任务13: 实现子码管理逻辑
  - 二维码上传和预览
  - 阈值输入和验证
  - 权重/状态开关
  - 删除子码
  - 上移排序
  - 添加子码

- [ ] 任务14: 实现分流模式配置
  - 阈值切换模式
  - 随机展示模式
  - 固定一张模式

#### 后端 - 文件上传
- [ ] 任务15: 实现文件上传API
  - 图片上传接口
  - 大小限制（≤5MB）
  - 格式验证（JPG/PNG）
  - Base64转换
  - 文件存储到data/images/目录

**验证标准**:
- [ ] 登录功能完整可用
- [ ] 可创建、编辑、删除活码
- [ ] 活码列表正确显示
- [ ] 子码上传、预览、配置正常
- [ ] 三种分流模式配置正确

---

### 阶段 3: 高级功能（Phase 3 - Advanced Features）
**目标**: 实现推广码、统计等高级功能

#### 推广码功能
- [ ] 任务16: 实现推广码弹窗（前端）
  - 推广管理入口弹窗
  - 推广码展示弹窗
  - 二维码展示
  - 链接复制功能
  - 下载二维码图片
  - 复制成功提示

- [ ] 任务17: 实现推广码API（后端）
  - POST /api/admin/live-codes/:id/promotion-code（生成）
  - GET /api/admin/live-codes/:id/promotion-code（获取）
  - 短链生成逻辑
  - 二维码生成（使用qrcode库）

#### 数据统计
- [ ] 任务18: 实现活码访问统计（后端）
  - PV计数逻辑
  - 统计数据持久化
  - 统计API接口
  - 时间范围查询

- [ ] 任务19: 设计并实现数据统计页面（前端）
  - 时间范围选择器
  - 核心指标卡片（总PV、UV、转化率）
  - 访问趋势图表（使用ECharts）
  - 子码使用分布图表
  - 详细数据表格

#### 状态管理
- [ ] 任务20: 实现状态管理
  - 运行中/已暂停状态切换
  - 状态标签显示（绿色/灰色）
  - 状态持久化

**验证标准**:
- [ ] 推广码生成和分享功能正常
- [ ] 链接复制和二维码下载可用
- [ ] 数据统计页面显示正确
- [ ] PV计数准确
- [ ] 状态切换正常

---

### 阶段 4: 用户体验优化（Phase 4 - UX Optimization）
**目标**: 提升用户体验和系统稳定性

#### 状态和反馈
- [ ] 任务21: 实现各种状态
  - Loading状态（骨架屏）
  - 空状态（插图+引导文案）
  - 错误状态（错误提示+重试按钮）
  - 成功状态（Toast通知）

#### 表单验证和错误处理
- [ ] 任务22: 实现表单验证和错误处理
  - 前端验证规则（Element Plus Form）
  - 后端验证（zod）
  - 错误提示文案
  - Toast通知组件封装
  - 异常捕获和处理

#### 性能优化
- [ ] 任务23: 实现性能优化
  - 图片懒加载
  - API请求防抖
  - 路由懒加载
  - 静态资源缓存
  - 组件keep-alive

#### 响应式设计
- [ ] 任务24: 实现响应式设计
  - 移动端适配（<768px）
  - 平板端适配（768px-1024px）
  - 不同屏幕尺寸测试
  - 触摸操作优化

**验证标准**:
- [ ] 所有状态（Loading/空/错误）正确显示
- [ ] 表单验证准确，错误提示清晰
- [ ] 页面加载流畅
- [ ] 移动端体验良好

---

### 阶段 5: 测试和部署（Phase 5 - Testing & Deployment）
**目标**: 确保系统稳定性和可部署性

#### 测试
- [ ] 任务25: 编写单元测试
  - 核心业务逻辑测试
  - API接口测试
  - 组件测试（使用Vue Test Utils）
  - 覆盖率 > 80%

- [ ] 任务26: 编写集成测试
  - 完整流程测试（登录-创建-编辑-删除）
  - 并发访问测试
  - 边界情况测试
  - JSON文件锁定测试

#### 部署
- [ ] 任务27: 配置部署环境
  - 生产环境变量配置
  - 构建优化（代码分割、压缩）
  - Nginx配置（反向代理）
  - PM2进程管理（后端）

- [ ] 任务28: 编写部署文档
  - 环境要求说明
  - 部署步骤
  - 常见问题排查
  - 监控和日志

**验证标准**:
- [ ] 所有测试通过
- [ ] 可成功构建生产版本
- [ ] 部署到生产环境可正常运行
- [ ] 文档完整准确

---

## 优先级说明

### High Priority (高优先级)
- 必须在早期阶段完成
- 阻塞其他功能开发
- 影响系统核心架构

### Medium Priority (中优先级)
- 核心功能实现
- 影响用户体验
- 可在阶段2-3完成

### Low Priority (低优先级)
- 优化和增强功能
- 可在后期迭代
- 不影响MVP交付

---

## 里程碑（Milestones）

### Milestone 1: 基础设施完成
**时间**: Week 1
**目标**: 前后端基础架构搭建完成，登录功能可用
**交付**:
- 前端可正常启动
- 后端API可正常启动
- 登录功能可用

### Milestone 2: 核心功能完成
**时间**: Week 2
**目标**: 活码CRUD功能完整可用
**交付**:
- 可创建、编辑、删除活码
- 活码列表正常显示
- 子码管理功能完整

### Milestone 3: 高级功能完成
**时间**: Week 3
**目标**: 推广码和统计功能完成
**交付**:
- 推广码生成和分享可用
- 数据统计页面可用
- 状态管理完整

### Milestone 4: MVP交付
**时间**: Week 4
**目标**: 系统可部署到生产环境
**交付**:
- 所有核心功能可用
- 用户体验良好
- 文档完整
- 测试通过

---

## 风险和挑战

### 技术风险
1. **JSON文件并发写入**
   - 风险: 高并发场景下数据冲突
   - 缓解: 使用proper-lockfile实现文件锁

2. **文件上传和存储**
   - 风险: 大文件上传影响性能
   - 缓解: 限制文件大小（5MB），使用Base64存储

3. **前端性能**
   - 风险: 大量活码导致页面卡顿
   - 缓解: 虚拟滚动、分页加载

### 业务风险
1. **需求变更**
   - 风险: 需求可能频繁调整
   - 缓解: 模块化设计，保持灵活性

2. **并发访问**
   - 风险: 大量扫码请求影响性能
   - 缓解: 优化JSON读取逻辑，考虑缓存

---

## 资源需求

### 开发资源
- 前端开发: 1人
- 后端开发: 1人
- 设计支持: 按需

### 技术栈
- 前端: Vue 3, Vite, Element Plus, Pinia, Vue Router, Axios
- 后端: Node.js, Fastify, proper-lockfile, zod, qrcode
- 工具: TypeScript, ESLint, Prettier, PM2, Nginx

---

## 后续规划

### Phase 6: 迭代优化
- 用户反馈收集
- 性能监控和优化
- 功能增强（批量操作、导出等）

### Phase 7: 多租户支持
- 多用户管理
- 权限控制
- 数据隔离

### Phase 8: 数据分析增强
- 实时数据看板
- 高级图表
- 数据导出

---

## 参考文档
- [admin-design.md](./admin-design.md) - 管理后台设计文档
- [AGENTS.md](../AGENTS.md) - 开发规范和流程
- [pm.md](../pm.md) - 产品经理工作规范
